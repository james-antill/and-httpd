2005-11-27  James Antill  <james@and.org>

	* scripts/tst-root-run.sh: Same as tst-run.sh, but as root.

	* scripts/coverage.sh: Add coverage script.

	* src/httpd_conf_main.c (httpd__conf_main_policy_http_d1): Move
	HTTP strictness checks into namespaces.

	* src/httpd.c (http_fin_err_req): Allow custom error pages for all but
	redirect errors.
	(http__parse_hdrs): Xtra Message changes.
	(http_parse_host): Xtra Message changes.
	(httpd_serv_add_vhost): Remove dots from the front in canonize.

	* src/httpd.h (struct Http_hdrs): Move Range from multi header to single
	header (didn't parse as a multi header anyway).

	* src/and-cntl.c (cl_timer_con): Fix bug in many connects, where timer
	didn't run.
	(cl_timer_cli): Fix memory bug where timer isn't removed on deletion.
	(cl_init): Add timer_q-1.0.5 workarounds.

	* scripts/conv_err_html2txt.pl (html_to_text): Add non-lynx
	html -> text converter (from jwz).

	* err/400.de.html: Add german error page translations.

	* err/400.fr.html: Add french error page translations.

2005-11-22  James Antill  <james@and.org>

	* src/Makefile.am (CFLAGS): Override CFLAGS to remove -O2 on debug

	* src/httpd.c (httpd__valid_hostname): Do optional extra validity
	checks on hostnames.
	(httpd_valid_url_filename): Fix interface bug when checking hostnames
	as a section of a Vstr.

2005-11-21  James Antill  <james@and.org>

	* src/httpd_conf_req.c (httpd__conf_req_d1): Add 406 type to req conf.
	error types.

2005-11-20  James Antill  <james@and.org>

	* src/httpd.c (http__parse_hdrs): Add 411 checking for
	Transfer-Encoding header.

2005-11-15  James Antill  <james@and.org>

	* src/httpd.c (http__parse_hdrs): Add preference for no content-length
	checking, and use a 411 error instead of a generic 400.

2005-11-08  James Antill  <james@and.org>

	* src/httpd_conf_req.c (httpd__conf_req_d1): Fix spelling of permanent.

	* src/httpd.c (http__resp_len): Calc. real length of response data for
	multipart/byterange responses.

	* src/httpd_err_codes.h (HTTPD_ERR_MSG): Add internal message, so we
	can tell how common errors are generated.
	(HTTPD_REDIR_MSG): Use single redir. macro, with internal message.

2005-11-01  James Antill  <james@and.org>

	* src/and-httpd.c: Move PROC_CNTL defines so they work.

2005-10-26  James Antill  <james@and.org>

	* src/opt_serv.c (opt_serv_sc_rlim_as_num): Added RLIMIT_AS support.
	(opt_serv__conf_d1): Added <max> support to queue listen length.

2005-10-25  James Antill  <james@and.org>

	* tools/scons_and_httpd_helpers.py.in (init_builders): Fix path to have
	-tools on the end.

2005-10-25  James Antill  <james@and.org>

	* NEWS: Release 0.99.5

2005-10-25  James Antill  <james@and.org>

	* tools/_,tools.conf: Add w3c like tools urls.

	* tools/_redirect-index.conf: Seperate the redirect out into a conf.d
	file.

	* tools/scons_and_httpd_helpers.py.in (init_builders): The compress
	builders use the gzip-r script now that you can specify an output file.

	* tools/gzip-r (zip__file): Allow specifying the output name.

	* src/httpd_conf_req.c (httpd__meta_build_path): Add a meta command
	to make the URL absolute immediately after doing a Location:.

	* src/httpd.c (http__try_encoded_content): Remove encoded extension from
	filename on failure.

2005-10-21  James Antill  <james@and.org>

	* src/vlg.c (vlg_pid_file): Add return to pidfile.

	* src/conf.h (conf_parse_num_token): Speed improvement.
	(conf_parse_token): Always reset the copy of sects->num, as it could
	have grown since we stored the token.

	* src/httpd_conf_main.c (httpd__match_iter_nxt): Remove dead code.

2005-10-20  James Antill  <james@and.org>

	* tools/Makefile.am (cronddir): Made gzip-r hourly.

	* src/evnt.c (EVNT__RESOLVE_NAME): Minor performance tweak for addrs
	that are really IPs.

	* src/httpd_conf_main.c (httpd__match_make): Fix bad reference setup,
	leaks Vstr's.

	* src/evnt.c (evnt_poll_add): Work around valgrind uninit errors.

	* tst/tst_httpd_conf.pl: Auto work out max conf files (and fix 8 and 9
	to work together).

	* scripts/tst-run.sh: Added script to run local config.

	* src/date.c (date_localtime): Added function.
	(date_syslog): Changed to use the Date_store, as strftime() is
	horrible to use from a signal handler ... and _slow_ on FC4.

	* tools/and-httpd.in: Use --config-dir

	* src/and-httpd.c (usage): Add --config-dir options.

	* src/opt_serv.c (opt_serv_sc_config_dir): Add internal conf.d
	processing.

	* tools/mime_types_extra.txt: Fix .xml files mime/type

2005-10-18  James Antill  <james@and.org>

	* NEWS: Release 0.99.4

2005-10-18  James Antill  <james@and.org>

	* src/opt_serv.c (opt_serv_sc_append_homedir): Resolve 
	username -> homedir for paths.

	* src/and-httpd.c (serv_cmd_line): Resolve username -> uids before
	calling chroot().

2005-10-17  James Antill  <james@and.org>

	* src/httpd.c (HTTPD_CONF_ZIP_LIMIT_MIN): Add minimum file length for
	trying zipped files.

	* src/httpd.c (http_fin_err_req): Fix fd bug on zero length error
	files.
	(http_fin_err_req): Fix bug on HEAD ops on custom err files.

	* src/httpd_conf_req.c (httpd__conf_req_d1): Add ability to give
	numbers to dynamic expires configurations.

	* src/vlg.c (VLG__SIG_BLOCK_BEG): Don't do anything before we set
	vlg__in_signal.

2005-10-16  James Antill  <james@and.org>

	* src/opt_serv.c (opt_serv__sig_raise_cont): Change _info to _warn.

	* src/httpd.c (http_parse_quality): Fix bug in parsing quality values of
	1.0 and 1.00
	(http_fin_err_req): Fix assert() when outputting gzipped custom error
	pages.

2005-10-15  James Antill  <james@and.org>

	* src/httpd_conf_main.c (httpd__match_find): return failure if there is
	no match list (couldn't happen).
	(httpd__match_find_before): return failure if there is no match
	list (couldn't happen).

	* tools/and-httpd_gzip.in: Use correct path.

	* Documentation/and-httpd_pad.xml: Add a PAD file.

	* src/httpd.c (http__parse_hdrs): Fail if we've got content-type/lang
	but no content-legnth = 0.

	* src/httpd.c (http_fin_err_req): Added more errors that can go through
	FS.
	(http__policy_req): Free current req when a match-request BLOCKs a
	connection.

	* tools/Makefile.am (crond_SCRIPTS): Added cron helpers.

	* err/Makefile.am (err_DATA): Added error pages on FS.

2005-10-14  James Antill  <james@and.org>

	* src/httpd_conf_req.c (httpd__conf_req_d1): Add return code names.

2005-10-11  James Antill  <james@and.org>

	* src/opt_policy.c (opt_policy_sc_conf_parse): Don't allow copy/inherit
	from the current policy.

	* src/httpd_conf_req.c (httpd__conf_req_d1): Add 
	content-language-extension and content-type-extension (renaming
	negotiate-* to *-negotiate, with backwards compat.)

	* src/httpd_conf_req.c (httpd__meta_build_path): Add none bracketed 
	names.

	* src/conf.h (conf_parse_num_token): Allow going to a previous token.

	* src/conf.h (conf_parse_end_token): Fix bug when skipping a lower
	depth than current.

	* src/httpd_conf_main.c (httpd__match_make): Allow positions for
	matches, and ability to add after/before them. Allow stopping of the
	match. Minor opt.

	* tools/Makefile.am (toolsmaindir): Move directory.
	(toolsmain_SCRIPS): Remove extensions.
	(toolsmain_DATA): Rename scons helper module.

2005-10-09  James Antill  <james@and.org>

	* src/opt_serv.c (opt_serv__match_init_tst_d1): Allow hostname
	comparison.
	(opt_serv__conf_d1): Add dumpable.
	(opt_serv_sc_append_cwd): Don't allocate forever.

	* src/httpd_conf_main.c (httpd__conf_main_policy_http_d1): Add explicit
	"off" authentication.
	(httpd__conf_main_policy_http_d1): Move "Server:" configuration to this
	depth.

2005-10-07  James Antill  <james@and.org>

	* src/cntl.c (cntl_pipe_acpt_fds): Add error checking to PDEATHSIG
	setting.

2005-09-29  James Antill  <james@and.org>

	* src/ex_utils.h (O_NOATIME): Add O_NOATIME support, and configuration.

2005-09-22  James Antill  <james@and.org>

	* NEWS: Release 0.99.2

2005-09-20  James Antill  <james@and.org>

	* src/evnt.c (evnt_recv): Make sure readv() goes up, even if we have no
	cached buffers.

	* src/httpd.c (http_response_ok): Always use strong comparison for
	if-match.

	* src/httpd_conf_main.c (httpd__policy_request_d1): Add "tag"s to
	the connection and request structs.

	* tools/and-httpd.conf: Change default config file to include rlimit
	increases, and larger max-connections for root users.

	* tools/make_index.pl: Fix directory names for non-path directories.

2005-09-19  James Antill  <james@and.org>

	* src/evnt.c (evnt__timer_cb_mtime): Allow configurable option of
	instant close on timeout.

	* src/Makefile.am: Move from _DATA to _BIN so things get chmod +x.

2005-09-18  James Antill  <james@and.org>

	* NEWS: Release 0.99.1

2005-09-11  James Antill  <james@and.org>

	* and-httpd.spec.in: Done first real build.

2005-08-30  James Antill  <james@and.org>

	* : Initial import from Vstr

